{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"client/template/components/sendEther.js","filenameRelative":"client/template/components/sendEther.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"client/template/components/sendEther.js.map","sourceFileName":"client/template/components/sendEther.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"sendEther"},"ignored":false,"code":"var estimatedFeeInWei = function () {\n  var gas = Session.get('sendEther.estimatedGas');\n  var gasPrice = new BigNumber(Session.get('sendEther.currentGasPrice'));\n  return gasPrice.mul(gas);\n};\n\nvar estimationCallback = function (e, res) {\n  var template = this;\n  console.log('Estimated gas: ', res, e);\n\n  if (!e && res) {\n    Session.set('sendEther.estimatedGas', res);\n  }\n};\n\nvar getGasPriceCallback = function (e, res) {\n  var template = this;\n  console.log('Current Gas Price in Wei: ', res.toString(10), e);\n\n  if (!e && res) {\n    Session.set('sendEther.currentGasPrice', res.toString(10));\n  }\n};\n\nTemplate.sendEtherComponent.events({\n  'submit form': function (e) {\n    var template = this;\n    e.preventDefault();\n    var fundInfo = {\n      fAddr: $(e.target).find('[name=f-addr]').val(),\n      tAddr: $(e.target).find('[name=t-addr]').val(),\n      amount: web3.toWei($(e.target).find('[name=amount]').val(), 'ether')\n    };\n\n    if (EthAccounts.findOne({\n      address: fundInfo.fAddr\n    }, {\n      reactive: false\n    })) {\n      Session.set('sendEther.fundInfo', fundInfo);\n      web3.eth.estimateGas({\n        from: fundInfo.fAddr,\n        to: fundInfo.tAddr,\n        value: fundInfo.amount\n      }, estimationCallback.bind(template));\n      web3.eth.getGasPrice(getGasPriceCallback.bind(template));\n      $('#sendConfirmModal').modal('show');\n    }\n  }\n});\nTemplate.sendConfirmModalTemplate.helpers({\n  sendAmountInEther: function () {\n    var amountEth = web3.fromWei(Session.get(\"sendEther.fundInfo\").amount, 'ether');\n    return parseFloat(amountEth).toFixed(3);\n  },\n  fAddr: function () {\n    return Session.get(\"sendEther.fundInfo\").fAddr;\n  },\n  tAddr: function () {\n    return Session.get(\"sendEther.fundInfo\").tAddr;\n  },\n  fee: function () {\n    return web3.fromWei(estimatedFeeInWei(), 'ether').toString(10);\n  }\n});\nTemplate.sendConfirmModalTemplate.events({\n  'click #send': function (e) {\n    e.preventDefault();\n    var fundInfo = Session.get(\"sendEther.fundInfo\");\n    web3.eth.sendTransaction({\n      from: fundInfo.fAddr,\n      to: fundInfo.tAddr,\n      value: fundInfo.amount\n    }, function (error, txHash) {\n      console.log(\"Transaction Hash:\", txHash, error);\n\n      if (!error) {\n        alert(\"Ether Transfer Succeeded\");\n      } else {\n        alert(\"Ether Transfer Failed\");\n      }\n    });\n    $('#sendConfirmModal').modal('hide');\n  }\n});","map":{"version":3,"sources":["client/template/components/sendEther.js"],"names":["estimatedFeeInWei","gas","Session","get","gasPrice","BigNumber","mul","estimationCallback","e","res","template","console","log","set","getGasPriceCallback","toString","Template","sendEtherComponent","events","preventDefault","fundInfo","fAddr","$","target","find","val","tAddr","amount","web3","toWei","EthAccounts","findOne","address","reactive","eth","estimateGas","from","to","value","bind","getGasPrice","modal","sendConfirmModalTemplate","helpers","sendAmountInEther","amountEth","fromWei","parseFloat","toFixed","fee","sendTransaction","error","txHash","alert"],"mappings":"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","file":"client/template/components/sendEther.js.map","sourcesContent":["var estimatedFeeInWei =  function(){\n  var gas = Session.get('sendEther.estimatedGas');\n  var gasPrice = new BigNumber(Session.get('sendEther.currentGasPrice'));\n  return gasPrice.mul(gas);\n}\n\nvar estimationCallback = function(e, res){\n    var template = this;\n    console.log('Estimated gas: ', res, e);\n    if(!e && res) {\n        Session.set('sendEther.estimatedGas', res);\n    }\n};\n\nvar getGasPriceCallback = function(e, res){\n    var template = this;\n    console.log('Current Gas Price in Wei: ', res.toString(10), e);\n    if(!e && res) {\n        Session.set('sendEther.currentGasPrice', res.toString(10));\n    }\n};\n\nTemplate.sendEtherComponent.events({\n  'submit form': function(e) {\n    var template = this;\n    e.preventDefault();\n    var fundInfo = {\n      fAddr: $(e.target).find('[name=f-addr]').val(),\n      tAddr: $(e.target).find('[name=t-addr]').val(),\n      amount: web3.toWei($(e.target).find('[name=amount]').val(),'ether')\n    };\n\n    if(EthAccounts.findOne({address: fundInfo.fAddr}, {reactive: false})) {\n      Session.set('sendEther.fundInfo', fundInfo);\n      web3.eth.estimateGas({from: fundInfo.fAddr, to: fundInfo.tAddr, value: fundInfo.amount}, estimationCallback.bind(template));\n      web3.eth.getGasPrice(getGasPriceCallback.bind(template));\n      $('#sendConfirmModal').modal('show');\n    }\n  }\n});\n\nTemplate.sendConfirmModalTemplate.helpers({\n  sendAmountInEther: function(){\n    var amountEth = web3.fromWei(Session.get(\"sendEther.fundInfo\").amount,'ether');\n    return parseFloat(amountEth).toFixed(3);\n  },\n  fAddr: function(){\n    return Session.get(\"sendEther.fundInfo\").fAddr;\n  },\n  tAddr: function(){\n    return Session.get(\"sendEther.fundInfo\").tAddr;\n  },\n  fee: function(){\n    return web3.fromWei(estimatedFeeInWei(),'ether').toString(10);\n  }\n});\n\nTemplate.sendConfirmModalTemplate.events({\n  'click #send': function(e) {\n    e.preventDefault();\n    var fundInfo = Session.get(\"sendEther.fundInfo\");\n    web3.eth.sendTransaction({\n      from: fundInfo.fAddr,\n      to: fundInfo.tAddr,\n      value: fundInfo.amount\n    }, function(error, txHash){\n      console.log(\"Transaction Hash:\", txHash, error);\n      if(!error) {\n        alert(\"Ether Transfer Succeeded\");\n      } else {\n        alert(\"Ether Transfer Failed\");\n      }\n    });\n    $('#sendConfirmModal').modal('hide');\n}});\n"]},"hash":"a28d6ffca2242416bb406e598a57c67ec2e7bea4"}
